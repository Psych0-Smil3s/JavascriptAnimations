<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js"></script>-->
    <style type="text/css">
        /******************************
         * The following styles are only
         * for browser based testing.
         ******************************/
        .wrapper {
            position: relative;
            width: 600px;
            margin: 100px;
            overflow: visible;
            border-radius: 5px;
        }
        .wrapper .editor {
            margin-top: 10px !important;
        }
        /******************************
         * Message styles
         ******************************/

        * {
            overflow: auto;
            margin: 0;
            padding: 0;
        }
        .animals-horse, .animals-horse * {
            overflow: visible;
        }
        .loader {
            position: absolute;
        }
        .animals-horse {
            background: #0f637d url(http://media.parlingo.com/website/live/messagepacks/animals/horseScene1.png) no-repeat;
            border-radius: inherit;
            height: 113px;
            background-size: 600px 113px;
            background-position: left bottom;
            position: relative;
            border: solid 1px #999;
            text-align: center;
        }
        .animals-horse .animals-horse-header {
            width: 100%;
            position: absolute;
            z-index: 11;
            top: 0;
            left: 0;
        }
        .animals-horse-header .timestamp, .animals-horse-header .flags, .animals-horse-header .nickname {
            float: left;
            padding: 2px 5px;
            color: #666;
        }
        .animals-horse-header .timestamp, .animals-horse-header .flags {
            float: right;
            padding-left: 10px;
        }

        .animals-horse-outer
        {
            margin-left: 110px;
            margin-top: 20px;
            margin-right: 10px;
        }

        .animals-horse-outer.editor
        {
            margin-top: 10px;
        }

        .animal-horse-message-entry
        {

            border: none;
            background-color:transparent;
            background:url(http://media.parlingo.com/website/live/messagepacks/love/bear/bg_input.png) repeat;
            width: 100%;
            height:78px;
            color: #000; /* 663333 */
            padding: 5px;
            margin: 0px;
            position:relative;
            z-index:9999;
            text-wrap: avoid;
            white-space: pre-wrap;
            word-wrap : break-word;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            resize:vertical;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
        }

        /* triangle border */
        .triangle-border {
            position:relative;
            /*margin:1em 0 3em;*/
            border:2px solid #fff; /* 5 */
            color:#333;
            background-color:transparent;
            background:url(http://media.parlingo.com/website/live/messagepacks/love/bear/bg_input.png) repeat;
            -webkit-border-radius:10px;
            -moz-border-radius:10px;
            border-radius:10px;
        }

        .triangle-border:before {
            content: "";
            position: absolute;
            border-style: solid;
            display: block;
            width: 0;
        }
        .triangle-border:after {
            content: "";
            position: absolute;
            border-style: solid;
            display: block;
            width: 0;
        }

        /* triangle border left */
        .triangle-border.left {
            margin-left:30px;
        }

        .triangle-border.left:before {
            top: 55px;
            bottom: auto;
            left: -25px;
            border-width: 10px 25px 10px 0;
            border-color: transparent #fff;
        }

        .triangle-border.left:after {
            top: 59px;
            bottom: auto;
            left: -21px;
            border-width: 6px 18px 6px 0;
            border-color: transparent #eeb34d;
        }

        .animals-horse.editor, .animals-horse.msie {
            background: #0f637d url(http://media.parlingo.com/website/live/messagepacks/animals/horse.png) no-repeat;
            background-size: 600px 113px;
            background-position: left bottom;

        }

        @media only screen and (-webkit-min-device-pixel-ratio: 2) {
            .animals-horse.editor, .animals-horse.msie {
                background: #0f637d url(http://media.parlingo.com/website/live/messagepacks/animals/horse.png) no-repeat;
                background-size: 600px 113px;
            }

        }

        @-moz-document url-prefix() {
            .animals-horse.editor, .animals-horse.msie {
                background: #0f637d url(http://media.parlingo.com/website/live/messagepacks/animals/horse.png) no-repeat;
                background-size: 600px 113px;
            }

        }

    </style>
</head>
<body>
<div class="wrapper">

    <div class="animals-horse msie">
        <div class="animals-horse-header">
            <span class="timestamp"></span>
            <span class="flags"></span>
            <strong class="nickname"></strong>
        </div>
        <div class="animals-horse-outer">
            <div class="triangle-border left">
                <p id="message" class="animal-horse-message-entry loader message-bubble"></p>
            </div>
        </div>
    </div>

    <div class="animals-horse editor">
        <form>
            <div class="animals-horse-outer">
                <p class="triangle-border left">
                    <textarea class="animal-horse-message-entry" name="message" max-newlines="4" max-length="60" maxlength="60"></textarea>
                </p>
            </div>
        </form>
    </div>

</div>
</body>

<script type="text/javascript" defer="defer">
    //<![CDATA[

    // Namespace
    this.MP = this.MP || {};

    (function($){

        $(document).ready(function () {

            var h = new MP.Horse();
            h.animals_horse_loaded();

        });

    }(jQuery));

    (function($){

        function Horse() {

            this.me = $('.loader').closest('.animals-horse');
            this.meBubble =  $('.loader').closest('.animals-horse .animals-horse-outer');
            this.msgPackWidth = $(this.me).width();
            this.MSG_PACK_WIDTH_BOUND = 500;

            this.animals_horse_show_bubble = function() {
                $(this.meBubble).fadeIn('fast');
            }

            this.animals_horse_set_speechBubble_size = function() {
                if (this.msgPackWidth > this.MSG_PACK_WIDTH_BOUND) {
                    this.meBubble.css({width: "35%" });
                }
            }

            this.animals_horse_loaded = function() {

                var self = this; // use bind() on events if jquery gets updated to 1.7

                if (navigator.userAgent.toLowerCase().indexOf('msie') === -1) {

                    $(this.meBubble).hide();

                    this.me.toggleClass('go');

                    // Start the animated gif
                    if (this.me.hasClass('go')) {

                        this.animals_horse_set_speechBubble_size();

                        // Create <img> element and give it the animated gif as a src.  To
                        // force a reload - add a date parameter to the URL
                        var img = document.createElement('img');
                        img.src = "http://media.parlingo.com/website/live/messagepacks/animals/horse.gif?p" + new Date().getTime();

                        this.me.removeClass('msie');

                        // Once the image has loaded, set it as the background-image
                        $(img).load(function(){
                            self.me.css({backgroundImage: "url("+img.src+" )"});
                            self.me.css({backgroundRepeat: "no-repeat"});
                            setTimeout(function() { self.animals_horse_show_bubble.call(self); }, 1000);
                        });

                        // Remove the background-image
                    } else {
                        this.me.css({backgroundImage: "none"});
                    }
                }

            }
        }

        MP.Horse = Horse;

    }(jQuery));

    //]]>
</script>

</html>